<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Face Similarity Test - Modern Design</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      /* Modern Color Palette */
      --primary: #6366f1;
      --primary-light: #818cf8;
      --primary-dark: #4f46e5;
      --secondary: #10b981;
      --secondary-light: #34d399;
      --accent: #f59e0b;
      --danger: #ef4444;
      --warning: #f97316;

      /* Neutral Colors */
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-400: #9ca3af;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --gray-900: #111827;

      /* Background */
      --bg-primary: #ffffff;
      --bg-secondary: var(--gray-50);
      --bg-tertiary: var(--gray-100);

      /* Text */
      --text-primary: var(--gray-900);
      --text-secondary: var(--gray-600);
      --text-muted: var(--gray-500);

      /* Borders */
      --border-light: var(--gray-200);
      --border-medium: var(--gray-300);

      /* Shadows */
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);

      /* Spacing */
      --space-1: 0.25rem;
      --space-2: 0.5rem;
      --space-3: 0.75rem;
      --space-4: 1rem;
      --space-5: 1.25rem;
      --space-6: 1.5rem;
      --space-8: 2rem;
      --space-10: 2.5rem;
      --space-12: 3rem;
      --space-16: 4rem;
      --space-20: 5rem;

      /* Border Radius */
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;
      --radius-2xl: 1.5rem;
      --radius-full: 9999px;
      /* Added for fully rounded elements */

      /* Transitions */
      --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-normal: 300ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      padding: var(--space-6);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: var(--bg-primary);
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-xl);
      overflow: hidden;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: var(--space-12) var(--space-8);
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
    }

    .header-content {
      position: relative;
      z-index: 1;
    }

    .header h1 {
      font-size: clamp(2rem, 4vw, 3.5rem);
      font-weight: 700;
      margin-bottom: var(--space-4);
      letter-spacing: -0.025em;
    }

    .header p {
      font-size: 1.125rem;
      opacity: 0.9;
      max-width: 600px;
      margin: 0 auto;
      font-weight: 400;
    }

    /* Main Content */
    .main-content {
      padding: var(--space-8);
    }

    /* Model Selector */
    .model-section {
      margin-bottom: var(--space-10);
    }

    .section-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--space-4);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .model-selector {
      background: var(--bg-secondary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-xl);
      padding: var(--space-6);
      transition: var(--transition-normal);
    }

    .model-selector:hover {
      border-color: var(--primary-light);
      box-shadow: var(--shadow-md);
    }

    .select-wrapper {
      position: relative;
    }

    .model-selector select {
      width: 100%;
      padding: var(--space-4);
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-lg);
      font-size: 1rem;
      background: var(--bg-primary);
      color: var(--text-primary);
      cursor: pointer;
      transition: var(--transition-fast);
      appearance: none;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
      background-position: right var(--space-3) center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
      padding-right: var(--space-10);
    }

    .model-selector select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgb(99 102 241 / 0.1);
    }

    /* Info Card -- Modified */
    .info-card {
      background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
      /* Lighter, more subtle blue */
      border: 1px solid var(--primary-light);
      border-left: 5px solid var(--primary);
      /* Add a thicker left border for emphasis */
      border-radius: var(--radius-lg);
      padding: var(--space-5);
      margin: var(--space-6) 0;
      display: flex;
      align-items: flex-start;
      gap: var(--space-4);
      /* Slightly increased gap */
      box-shadow: var(--shadow-sm);
      /* Add a subtle shadow */
    }

    .info-icon {
      font-size: 1.8rem;
      /* Slightly larger icon */
      flex-shrink: 0;
      color: var(--primary-dark);
      /* Make icon color more prominent */
      padding-top: 2px;
      /* Align better with text */
    }

    .info-text {
      color: var(--gray-700);
      /* Darker text for better readability */
      font-size: 0.95rem;
      line-height: 1.6;
      /* Increased line-height for readability */
    }

    .info-text strong {
      color: var(--primary-dark);
      /* Emphasize the "Pro Tips" */
    }


    /* Image Upload Section */
    .upload-section {
      margin-bottom: var(--space-10);
    }

    .upload-grid {
      display: grid;
      /* Modified minmax */
      grid-template-columns: repeat(auto-fit, minmax(min(100%, 320px), 1fr));
      gap: var(--space-8);
      align-items: stretch;
      /* Added: Make grid items stretch to fill the height of the row */
    }

    .upload-card {
      background: var(--bg-primary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-xl);
      padding: var(--space-6);
      transition: var(--transition-normal);
      position: relative;
      display: flex;
      /* Added */
      flex-direction: column;
      /* Added */
    }

    .upload-card:hover {
      border-color: var(--primary-light);
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }

    /* Added: Pushes preview to the bottom if card grows, useful with flex-direction column */
    .upload-card .preview-container {
      margin-top: auto;
    }

    .upload-card.has-image {
      border-color: var(--secondary);
      background: linear-gradient(135deg, #ecfdf5 0%, #f0fdf4 100%);
    }

    .upload-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-5);
    }

    .upload-card-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .clear-btn {
      background: var(--danger);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      padding: var(--space-2);
      cursor: pointer;
      transition: var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .clear-btn:hover {
      background: #dc2626;
      transform: scale(1.05);
    }

    /* Method Toggle */
    .method-toggle {
      display: flex;
      background: var(--bg-tertiary);
      border-radius: var(--radius-lg);
      padding: var(--space-1);
      margin-bottom: var(--space-6);
    }

    .method-btn {
      flex: 1;
      background: transparent;
      border: none;
      padding: var(--space-3) var(--space-4);
      border-radius: var(--radius-md);
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-secondary);
      transition: var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
    }

    .method-btn.active {
      background: var(--bg-primary);
      color: var(--primary);
      box-shadow: var(--shadow-sm);
    }

    .method-btn:hover:not(.active) {
      color: var(--text-primary);
    }

    /* Upload Area */
    .upload-area {
      border: 2px dashed var(--border-medium);
      border-radius: var(--radius-lg);
      padding: var(--space-10) var(--space-6);
      text-align: center;
      cursor: pointer;
      transition: var(--transition-normal);
      background: var(--bg-secondary);
    }

    .upload-area:hover {
      border-color: var(--primary);
      background: #f8fafc;
    }

    .upload-area.dragover {
      border-color: var(--secondary);
      background: #ecfdf5;
      transform: scale(1.02);
    }

    .upload-area.error {
      border-color: var(--danger);
      background: #fef2f2;
    }

    .upload-icon {
      width: 48px;
      height: 48px;
      margin: 0 auto var(--space-4);
      background: var(--primary);
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
    }

    .upload-text {
      font-size: 1rem;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: var(--space-2);
    }

    .upload-subtext {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .file-input {
      display: none;
    }

    /* Webcam */
    .webcam-container {
      display: none;
      text-align: center;
    }

    .webcam-container.active {
      display: block;
    }

    .video-wrapper {
      position: relative;
      display: inline-block;
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-lg);
      background: var(--gray-900);
    }

    video {
      width: 100%;
      max-width: 400px;
      height: auto;
      display: block;
    }

    .video-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 150px;
      height: 150px;
      border: 3px solid rgba(255, 255, 255, 0.8);
      border-radius: 50%;
      pointer-events: none;
    }

    .capture-btn {
      background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
      color: white;
      border: none;
      padding: var(--space-3) var(--space-6);
      border-radius: var(--radius-lg);
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      margin-top: var(--space-4);
      transition: var(--transition-normal);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      margin-left: auto;
      margin-right: auto;
    }

    .capture-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    /* Preview */
    .preview-container {
      margin-top: var(--space-6);
      text-align: center;
    }

    .preview-img {
      max-width: 100%;
      max-height: 300px;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      display: none;
      transition: var(--transition-normal);
    }

    .preview-img:hover {
      transform: scale(1.02);
    }

    .image-info {
      margin-top: var(--space-3);
      padding: var(--space-2) var(--space-4);
      background: var(--bg-tertiary);
      border-radius: var(--radius-lg);
      font-size: 0.875rem;
      color: var(--text-secondary);
      display: none;
      inline-size: fit-content;
      margin-left: auto;
      margin-right: auto;
    }

    /* Messages */
    .message {
      padding: var(--space-4);
      border-radius: var(--radius-lg);
      margin: var(--space-4) 0;
      display: none;
      font-size: 0.875rem;
      font-weight: 500;
    }

    .error-message {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #dc2626;
    }

    .success-message {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      color: #16a34a;
    }

    /* Analyze Button */
    .analyze-section {
      text-align: center;
      margin: var(--space-10) 0;
    }

    .analyze-btn {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      border: none;
      padding: var(--space-4) var(--space-8);
      border-radius: var(--radius-xl);
      cursor: pointer;
      font-size: 1.125rem;
      font-weight: 600;
      transition: var(--transition-normal);
      position: relative;
      overflow: hidden;
      min-width: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      margin: 0 auto;
    }

    .analyze-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: var(--transition-slow);
    }

    .analyze-btn:hover:not(:disabled)::before {
      left: 100%;
    }

    .analyze-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: var(--shadow-xl);
    }

    .analyze-btn:disabled {
      background: var(--gray-300);
      color: var(--gray-500);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* Loading */
    .loader {
      width: 40px;
      height: 40px;
      border: 3px solid var(--gray-200);
      border-top: 3px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: var(--space-6) auto;
      display: none;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .btn-loading {
      color: transparent !important;
    }

    .btn-loading::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      top: 50%;
      left: 50%;
      margin-left: -10px;
      margin-top: -10px;
      border: 2px solid transparent;
      border-top-color: currentColor;
      /* Use white or a contrasting color if button bg changes */
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    /* Ensure spinner is visible on disabled loading button */
    .analyze-btn.btn-loading::after {
      border-top-color: white;
      /* Explicitly white for primary button bg */
    }


    /* Results -- Modified */
    .result-container {
      margin-top: var(--space-8);
    }

    #result {
      background: var(--bg-secondary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-xl);
      padding: var(--space-8) var(--space-6);
      /* Modified padding */
      text-align: center;
      transition: var(--transition-normal);
    }

    /* Added: Styling for initial message in results area */
    .initial-message {
      color: var(--text-muted);
      font-size: 1.125rem;
      padding: var(--space-8) 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: var(--space-4);
    }

    .initial-message>span:first-of-type {
      /* Icon styling */
      font-size: 2.5rem;
      opacity: 0.7;
      line-height: 1;
    }


    .result-success {
      background: linear-gradient(135deg, #ecfdf5 0%, #f0fdf4 100%);
      border-color: var(--secondary);
    }

    .result-error {
      background: linear-gradient(135deg, #fef2f2 0%, #fef7f7 100%);
      border-color: var(--danger);
    }

    .result-header {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: var(--space-6);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-3);
    }

    .result-header span:first-child {
      /* Icon */
      font-size: 1.8rem;
      /* Make icon slightly larger */
    }


    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-4);
      margin: var(--space-6) 0;
      text-align: left;
    }

    .result-item {
      background: var(--bg-primary);
      padding: var(--space-4);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-sm);
      /* Added subtle shadow to each item */
      transition: transform 0.2s ease-in-out;
      /* Added */
    }

    .result-item:hover {
      /* Added */
      transform: translateY(-2px);
    }


    .result-label {
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-bottom: var(--space-1);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .result-value {
      font-size: 1.125rem;
      /* Slightly larger value text -- Modified */
      font-weight: 600;
      color: var(--text-primary);
    }

    .similarity-section {
      margin: var(--space-8) 0;
    }

    .similarity-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-3);
    }

    .similarity-label {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .similarity-percentage {
      font-size: 1.75rem;
      /* Larger percentage -- Modified */
      font-weight: 700;
    }

    .similarity-bar {
      background: var(--gray-200);
      border-radius: var(--radius-full);
      /* Fully rounded bar -- Modified */
      height: 16px;
      /* Slightly thicker bar -- Modified */
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
      /* Inner shadow for depth -- Added */
    }

    .similarity-fill {
      height: 100%;
      border-radius: var(--radius-full);
      /* Fully rounded fill -- Modified */
      /* Smoother transition -- Modified */
      transition: width 1s cubic-bezier(0.25, 0.1, 0.25, 1);
      position: relative;
      overflow: hidden;
    }

    .similarity-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% {
        transform: translateX(-100%);
      }

      100% {
        transform: translateX(100%);
      }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      body {
        padding: var(--space-4);
      }

      .header {
        padding: var(--space-8) var(--space-6);
      }

      .main-content {
        padding: var(--space-6);
      }

      .upload-grid {
        grid-template-columns: 1fr;
        gap: var(--space-6);
      }

      .upload-card {
        padding: var(--space-5);
      }

      .method-toggle {
        flex-direction: column;
        gap: var(--space-1);
      }

      .result-grid {
        grid-template-columns: 1fr;
      }

      .similarity-header {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--space-2);
      }
    }

    @media (max-width: 480px) {
      body {
        /* Modified */
        padding: var(--space-3);
      }

      .header {
        /* Modified */
        padding: var(--space-6) var(--space-4);
      }

      .main-content {
        /* Modified */
        padding: var(--space-4);
      }

      .upload-card {
        /* Modified */
        padding: var(--space-4);
      }

      .upload-area {
        padding: var(--space-6) var(--space-4);
      }

      /* Added: Ensure select dropdown is still usable */
      .model-selector select {
        padding: var(--space-3);
        padding-right: var(--space-8);
        /* Ensure space for arrow */
        font-size: 0.9rem;
      }

      .analyze-btn {
        width: 100%;
        max-width: 300px;
        padding: var(--space-3) var(--space-6);
        /* Modified */
        font-size: 1rem;
        /* Modified */
      }
    }

    /* Accessibility */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Focus styles */
    button:focus,
    select:focus,
    input:focus,
    [tabindex]:focus {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }

    /* Override for specific elements if default is better */
    .model-selector select:focus {
      outline: none;
      /* Keep original softer focus */
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgb(99 102 241 / 0.1);
    }
  </style>
</head>

<body>
  <div class="container">
    <header class="header">
      <div class="header-content">
        <h1>🎭 Face Similarity Analysis</h1>
        <p>Advanced AI-powered face comparison with multiple recognition models</p>
      </div>
    </header>

    <main class="main-content">
      <section class="model-section">
        <h2 class="section-title">
          <span>🤖</span>
          AI Model Selection
        </h2>
        <div class="model-selector">
          <div class="select-wrapper">
            <select id="modelSelect" aria-describedby="model-help">
              <option value="VGG-Face">VGG-Face (Default - Fast & Accurate)</option>
              <option value="Facenet">FaceNet (Google - High Accuracy)</option>
              <option value="Facenet512">FaceNet512 (Enhanced Version)</option>
              <option value="OpenFace">OpenFace (Lightweight)</option>
              <option value="DeepFace">DeepFace (Facebook)</option>
              <option value="DeepID">DeepID (Academic Research)</option>
              <option value="ArcFace">ArcFace (State-of-the-art)</option>
              <option value="Dlib">Dlib (Traditional Method)</option>
              <option value="SFace">SFace (Lightweight & Fast)</option>
            </select>
          </div>
        </div>
      </section>

      <div class="info-card" id="model-help">
        <div class="info-icon">💡</div>
        <div class="info-text">
          <strong>Pro Tips:</strong> Use clear, well-lit photos with faces clearly visible. Different models may give
          varying results - try multiple models for comprehensive analysis. Supported formats: JPG, PNG, GIF, BMP (max
          10MB).
        </div>
      </div>

      <section class="upload-section">
        <h2 class="section-title">
          <span>📸</span>
          Image Upload
        </h2>
        <div class="upload-grid">
          <div class="upload-card" id="imageCard1">
            <div class="upload-card-header">
              <h3 class="upload-card-title">
                <span>🖼️</span>
                First Image
              </h3>
              <button class="clear-btn" onclick="clearImage(1)" style="display: none;" id="clearBtn1"
                aria-label="Clear first image">
                <span>✕</span>
                <span class="sr-only">Clear first image</span>
              </button>
            </div>

            <div class="method-toggle">
              <button class="method-btn active" onclick="switchMethod(1, 'file')" aria-pressed="true">
                <span>📁</span>
                Upload File
              </button>
              <button class="method-btn" onclick="switchMethod(1, 'webcam')" aria-pressed="false">
                <span>📷</span>
                Use Webcam
              </button>
            </div>

            <div class="upload-area" id="uploadArea1" onclick="document.getElementById('file1').click()" role="button"
              tabindex="0" aria-label="Upload first image">
              <div class="upload-icon">📁</div>
              <div class="upload-text">Click to upload or drag & drop</div>
              <div class="upload-subtext">JPG, PNG, GIF, BMP (max 10MB)</div>
              <input type="file" id="file1" class="file-input" accept="image/*" aria-label="Select first image file" />
            </div>

            <div class="webcam-container" id="webcamContainer1">
              <div class="video-wrapper">
                <video id="video1" autoplay playsinline muted aria-label="Webcam feed for first image"></video>
                <div class="video-overlay"></div>
              </div>
              <button class="capture-btn" onclick="captureImage(1)">
                <span>📷</span>
                Capture Photo
              </button>
            </div>

            <div class="preview-container">
              <img id="preview1" class="preview-img" alt="Preview of first uploaded image" />
              <div id="imageInfo1" class="image-info"></div>
            </div>

            <div id="error1" class="message error-message" role="alert"></div>
            <div id="success1" class="message success-message" role="status"></div>
          </div>

          <div class="upload-card" id="imageCard2">
            <div class="upload-card-header">
              <h3 class="upload-card-title">
                <span>🖼️</span>
                Second Image
              </h3>
              <button class="clear-btn" onclick="clearImage(2)" style="display: none;" id="clearBtn2"
                aria-label="Clear second image">
                <span>✕</span>
                <span class="sr-only">Clear second image</span>
              </button>
            </div>

            <div class="method-toggle">
              <button class="method-btn active" onclick="switchMethod(2, 'file')" aria-pressed="true">
                <span>📁</span>
                Upload File
              </button>
              <button class="method-btn" onclick="switchMethod(2, 'webcam')" aria-pressed="false">
                <span>📷</span>
                Use Webcam
              </button>
            </div>

            <div class="upload-area" id="uploadArea2" onclick="document.getElementById('file2').click()" role="button"
              tabindex="0" aria-label="Upload second image">
              <div class="upload-icon">📁</div>
              <div class="upload-text">Click to upload or drag & drop</div>
              <div class="upload-subtext">JPG, PNG, GIF, BMP (max 10MB)</div>
              <input type="file" id="file2" class="file-input" accept="image/*" aria-label="Select second image file" />
            </div>

            <div class="webcam-container" id="webcamContainer2">
              <div class="video-wrapper">
                <video id="video2" autoplay playsinline muted aria-label="Webcam feed for second image"></video>
                <div class="video-overlay"></div>
              </div>
              <button class="capture-btn" onclick="captureImage(2)">
                <span>📷</span>
                Capture Photo
              </button>
            </div>

            <div class="preview-container">
              <img id="preview2" class="preview-img" alt="Preview of second uploaded image" />
              <div id="imageInfo2" class="image-info"></div>
            </div>

            <div id="error2" class="message error-message" role="alert"></div>
            <div id="success2" class="message success-message" role="status"></div>
          </div>
        </div>
      </section>

      <section class="analyze-section">
        <button id="analyzeBtn" class="analyze-btn" disabled aria-describedby="analyze-help">
          <span>🔍</span>
          Analyze Similarity
        </button>
        <div id="analyze-help" class="sr-only">Analyze similarity between the two uploaded images</div>
      </section>

      <div id="loader" class="loader" aria-label="Processing images"></div>

      <section class="result-container">
        <div id="result" role="region" aria-live="polite">
          <div class="initial-message">
            <span>📤</span>
            Upload two images and select an AI model to begin analysis
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // Global variables
    let file1 = null;
    let file2 = null;
    let webcamStream1 = null;
    let webcamStream2 = null;
    let currentMethod = { 1: 'file', 2: 'file' };

    // Constants
    const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
    const ALLOWED_TYPES = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/bmp'];

    // Utility functions
    function showMessage(imageNum, message, type = 'error') {
      const errorDiv = document.getElementById(`error${imageNum}`);
      const successDiv = document.getElementById(`success${imageNum}`);
      const uploadArea = document.getElementById(`uploadArea${imageNum}`);

      if (type === 'error') {
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
        successDiv.style.display = 'none';
        if (uploadArea) uploadArea.classList.add('error'); // Check if uploadArea exists

        setTimeout(() => {
          errorDiv.style.display = 'none';
          if (uploadArea) uploadArea.classList.remove('error');
        }, 5000);
      } else {
        successDiv.textContent = message;
        successDiv.style.display = 'block';
        errorDiv.style.display = 'none';
        if (uploadArea) uploadArea.classList.remove('error'); // Also remove error class on success

        setTimeout(() => {
          successDiv.style.display = 'none';
        }, 3000);
      }
    }

    function validateFile(file, imageNum) {
      if (!file) {
        showMessage(imageNum, 'No file selected');
        return false;
      }

      if (!ALLOWED_TYPES.includes(file.type)) {
        showMessage(imageNum, 'Invalid file type. Please use JPG, PNG, GIF, or BMP.');
        return false;
      }

      if (file.size > MAX_FILE_SIZE) {
        showMessage(imageNum, 'File too large. Maximum size is 10MB.');
        return false;
      }

      return true;
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function updateImageInfo(imageNum, file) {
      const infoDiv = document.getElementById(`imageInfo${imageNum}`);
      const clearBtn = document.getElementById(`clearBtn${imageNum}`);

      if (file) {
        infoDiv.textContent = `${file.name} (${formatFileSize(file.size)})`;
        infoDiv.style.display = 'block';
        clearBtn.style.display = 'flex';
      } else {
        infoDiv.style.display = 'none';
        clearBtn.style.display = 'none';
      }
    }

    function updateImageCardState(imageNum, hasImage) {
      const imageCard = document.getElementById(`imageCard${imageNum}`);
      if (hasImage) {
        imageCard.classList.add('has-image');
      } else {
        imageCard.classList.remove('has-image');
      }
    }

    function clearImage(imageNum) {
      stopWebcam(imageNum); // Stop webcam if it was active for this card

      if (imageNum === 1) {
        file1 = null;
        document.getElementById('file1').value = ''; // Reset file input
        document.getElementById('preview1').src = '#'; // Clear preview src
        document.getElementById('preview1').style.display = 'none';
      } else {
        file2 = null;
        document.getElementById('file2').value = ''; // Reset file input
        document.getElementById('preview2').src = '#'; // Clear preview src
        document.getElementById('preview2').style.display = 'none';
      }

      updateImageInfo(imageNum, null);
      updateImageCardState(imageNum, false);
      // If switching from webcam, ensure file upload area is visible
      if (currentMethod[imageNum] === 'webcam') {
        switchMethod(imageNum, 'file'); // This will reset the UI to file upload
      }
      updateButtonState();
    }

    // Initialize drag and drop functionality
    function initializeDragAndDrop() {
      ['uploadArea1', 'uploadArea2'].forEach(id => {
        const area = document.getElementById(id);
        const imageNum = id.includes('1') ? 1 : 2;

        // Prevent default drag behaviors
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
          area.addEventListener(eventName, preventDefaults, false);
          document.body.addEventListener(eventName, preventDefaults, false); // For full page drop prevention
        });

        // Highlight drop area when item is dragged over it
        ['dragenter', 'dragover'].forEach(eventName => {
          area.addEventListener(eventName, () => area.classList.add('dragover'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
          area.addEventListener(eventName, () => area.classList.remove('dragover'), false);
        });

        // Handle dropped files
        area.addEventListener('drop', (e) => {
          const files = e.dataTransfer.files;
          if (files.length > 0) {
            handleFileSelect(files[0], imageNum);
          }
        }, false);

        // Keyboard accessibility
        area.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            document.getElementById(`file${imageNum}`).click();
          }
        });
      });
    }

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    function handleFileSelect(file, imageNum) {
      if (!validateFile(file, imageNum)) {
        if (imageNum === 1) file1 = null; else file2 = null; // Ensure file var is also cleared
        document.getElementById(`file${imageNum}`).value = ''; // Clear the actual input
        updateButtonState();
        return;
      }

      if (imageNum === 1) {
        file1 = file;
      } else {
        file2 = file;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        const preview = document.getElementById(`preview${imageNum}`);
        preview.src = e.target.result;
        preview.style.display = 'block';
        updateImageInfo(imageNum, file);
        updateImageCardState(imageNum, true);
        showMessage(imageNum, 'Image uploaded successfully!', 'success');
      };

      reader.onerror = function () {
        showMessage(imageNum, 'Error reading file. Please try again.');
        if (imageNum === 1) file1 = null; else file2 = null; // Clear file on error
        updateButtonState();
      };

      reader.readAsDataURL(file);
      updateButtonState();
    }

    // Modified: switchMethod is now async to handle webcam start failure
    async function switchMethod(imageNum, method) {
      currentMethod[imageNum] = method;

      const imageCard = document.querySelector(`#imageCard${imageNum}`);
      const buttons = imageCard.querySelectorAll('.method-btn');
      buttons.forEach((btn) => { // Simplified toggle based on currentMethod
        const btnMethod = btn.textContent.toLowerCase().includes('file') ? 'file' : 'webcam';
        const isActive = (method === btnMethod);
        btn.classList.toggle('active', isActive);
        btn.setAttribute('aria-pressed', isActive);
      });

      const uploadArea = document.getElementById(`uploadArea${imageNum}`);
      const webcamContainer = document.getElementById(`webcamContainer${imageNum}`);

      if (method === 'file') {
        uploadArea.style.display = 'block';
        webcamContainer.classList.remove('active');
        stopWebcam(imageNum);
      } else { // method === 'webcam'
        uploadArea.style.display = 'none';
        webcamContainer.classList.add('active');
        const webcamStarted = await startWebcam(imageNum); // await the result
        if (!webcamStarted) {
          // If webcam fails to start, revert to file input
          showMessage(imageNum, 'Failed to start webcam. Please check permissions or device. Reverting to file upload.', 'error');
          // Call switchMethod again to go back to 'file'
          // Add a check to prevent potential infinite loop if file method also has issues (unlikely for this specific scenario)
          if (currentMethod[imageNum] !== 'file') {
            await switchMethod(imageNum, 'file'); // Ensure this also completes
          }
        }
      }
    }

    // Modified: startWebcam now returns a boolean
    async function startWebcam(imageNum) {
      try {
        const video = document.getElementById(`video${imageNum}`);

        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
          throw new Error('Webcam API not supported in this browser.');
        }

        const stream = await navigator.mediaDevices.getUserMedia({
          video: {
            width: { ideal: 640 },
            height: { ideal: 480 },
            facingMode: 'user'
          }
        });

        video.srcObject = stream;
        // Added: Ensure video plays, catch errors
        video.onloadedmetadata = () => {
          video.play().catch(playError => {
            console.error(`Webcam video play failed for image ${imageNum}:`, playError);
            showMessage(imageNum, `Could not play webcam video: ${playError.message}`, 'error');
            // Consider this a failure for the webcam start process
            stopWebcam(imageNum); // Stop the tracks if play fails
            if (currentMethod[imageNum] === 'webcam') { // If still in webcam mode, try to revert
              switchMethod(imageNum, 'file');
            }
          });
        };

        if (imageNum === 1) {
          webcamStream1 = stream;
        } else {
          webcamStream2 = stream;
        }

        showMessage(imageNum, 'Webcam activated successfully!', 'success');
        return true; // Indicate success

      } catch (err) {
        console.error('Error accessing webcam:', err);
        let errorMessage = 'Could not access webcam. ';

        if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
          errorMessage += 'Please allow camera permissions in your browser settings and try again.';
        } else if (err.name === 'NotFoundError' || err.name === 'DevicesNotFoundError') {
          errorMessage += 'No camera found on this device.';
        } else if (err.name === 'NotSupportedError' || err.name === 'AbortError') {
          errorMessage += 'Webcam not supported or an issue occurred.';
        } else {
          errorMessage += `An unexpected error occurred: ${err.message}. Please check your camera and try again.`;
        }

        showMessage(imageNum, errorMessage, 'error');
        return false; // Indicate failure
      }
    }


    function stopWebcam(imageNum) {
      const stream = imageNum === 1 ? webcamStream1 : webcamStream2;
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        if (imageNum === 1) {
          webcamStream1 = null;
          const video = document.getElementById('video1');
          if (video) video.srcObject = null; // Clear video source
        } else {
          webcamStream2 = null;
          const video = document.getElementById('video2');
          if (video) video.srcObject = null; // Clear video source
        }
      }
      // Also hide the webcam container if it was active
      const webcamContainer = document.getElementById(`webcamContainer${imageNum}`);
      if (webcamContainer) webcamContainer.classList.remove('active');
    }

    function captureImage(imageNum) {
      const video = document.getElementById(`video${imageNum}`);

      if (!video.srcObject || video.videoWidth === 0 || video.videoHeight === 0) {
        showMessage(imageNum, 'Webcam not ready or stream ended. Please (re)start webcam and try again.');
        return;
      }

      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');

      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      canvas.toBlob((blob) => {
        if (!blob) {
          showMessage(imageNum, 'Failed to capture image. Please try again.');
          return;
        }

        const capturedFile = new File([blob], `webcam-capture-${imageNum}-${Date.now()}.jpg`, {
          type: 'image/jpeg'
        });

        if (imageNum === 1) {
          file1 = capturedFile;
        } else {
          file2 = capturedFile;
        }

        const preview = document.getElementById(`preview${imageNum}`);
        preview.src = canvas.toDataURL('image/jpeg'); // Use 'image/jpeg' for consistency
        preview.style.display = 'block';

        updateImageInfo(imageNum, capturedFile);
        updateImageCardState(imageNum, true);
        showMessage(imageNum, 'Photo captured successfully!', 'success');

        stopWebcam(imageNum); // Stop webcam after capture
        updateButtonState();
      }, 'image/jpeg', 0.9); // Specify JPEG format and quality
    }

    function updateButtonState() {
      const analyzeBtn = document.getElementById('analyzeBtn');
      const hasImages = file1 && file2;

      analyzeBtn.disabled = !hasImages;
      analyzeBtn.setAttribute('aria-disabled', String(!hasImages)); // Use string true/false

      // Clear any loading state
      analyzeBtn.classList.remove('btn-loading');

      if (hasImages) {
        analyzeBtn.innerHTML = '<span>🔍</span> Analyze Similarity';
      } else {
        const missing = [];
        if (!file1) missing.push('first image');
        if (!file2) missing.push('second image');
        analyzeBtn.innerHTML = `<span>📸</span> Please select ${missing.join(' and ')}`;
      }
    }

    function setButtonLoading(button, loading) {
      if (loading) {
        button.classList.add('btn-loading');
        button.disabled = true;
        button.setAttribute('aria-disabled', 'true');
      } else {
        button.classList.remove('btn-loading');
        // Re-enable button based on image state, not just unconditionally
        updateButtonState();
      }
    }

    // File input handlers
    document.getElementById('file1').addEventListener('change', function (event) {
      const file = event.target.files[0];
      if (file) {
        handleFileSelect(file, 1);
      }
    });

    document.getElementById('file2').addEventListener('change', function (event) {
      const file = event.target.files[0];
      if (file) {
        handleFileSelect(file, 2);
      }
    });

    // Analyze button handler
    document.getElementById('analyzeBtn').addEventListener('click', async function () {
      if (!file1 || !file2) {
        const resultDiv = document.getElementById('result');
        resultDiv.className = 'result-error'; // Use error class
        resultDiv.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; gap: var(--space-2); color: var(--danger);">
                                 <span>❌</span> Please select both images first.
                               </div>`;
        return;
      }

      const formData = new FormData();
      formData.append('image1', file1);
      formData.append('image2', file2);
      formData.append('model', document.getElementById('modelSelect').value);

      const resultDiv = document.getElementById('result');
      const loader = document.getElementById('loader');
      const analyzeBtn = document.getElementById('analyzeBtn');

      resultDiv.className = ''; // Clear previous result state classes
      resultDiv.innerHTML = `<div style="color: var(--text-secondary); font-size: 1.125rem; display: flex; align-items: center; justify-content: center; gap: var(--space-2);">
                               <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-cpu"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect><rect x="9" y="9" width="6" height="6"></rect><line x1="9" y1="1" x2="9" y2="4"></line><line x1="15" y1="1" x2="15" y2="4"></line><line x1="9" y1="20" x2="9" y2="23"></line><line x1="15" y1="20" x2="15" y2="23"></line><line x1="20" y1="9" x2="23" y2="9"></line><line x1="20" y1="14" x2="23" y2="14"></line><line x1="1" y1="9" x2="4" y2="9"></line><line x1="1" y1="14" x2="4" y2="14"></line></svg>
                               <span>Processing images with AI model...</span>
                             </div>`;
      loader.style.display = 'block';
      setButtonLoading(analyzeBtn, true);

      try {
        // Simulate API call with mock data
        await new Promise(resolve => setTimeout(resolve, 2000));

        // Mock response
        const models = {
          'VGG-Face': { distance: 0.23, threshold: 0.4, verified: true },
          'Facenet': { distance: 0.15, threshold: 0.4, verified: true },
          'Facenet512': { distance: 0.18, threshold: 0.3, verified: true },
          'OpenFace': { distance: 0.35, threshold: 0.4, verified: true },
          'DeepFace': { distance: 0.45, threshold: 0.68, verified: true },
          'DeepID': { distance: 0.52, threshold: 0.015, verified: false }, // Example of lower threshold and different verification
          'ArcFace': { distance: 0.12, threshold: 0.68, verified: true },
          'Dlib': { distance: 0.42, threshold: 0.6, verified: true },
          'SFace': { distance: 0.28, threshold: 0.593, verified: true }
        };

        const selectedModel = document.getElementById('modelSelect').value;
        const baseResult = models[selectedModel] || models['VGG-Face']; // Fallback to VGG-Face

        // Introduce more variability for mock results
        const randomFactor = 0.7 + Math.random() * 0.6; // More variance: e.g., 0.7 to 1.3
        let adjustedDistance = baseResult.distance * randomFactor;

        // Ensure distance doesn't become negative or overly large just for mock
        adjustedDistance = Math.max(0.01, Math.min(adjustedDistance, baseResult.threshold * 1.5));

        const verified = adjustedDistance < baseResult.threshold;

        // Calculate similarity: higher is better. If distance is 0, similarity is 100.
        // If distance >= threshold, similarity can be 0 or even slightly negative if we don't cap it.
        // A common way: 1 - (distance / threshold), then scale to 100. Cap at 0 and 100.
        let similarity = 0;
        if (baseResult.threshold > 0) { // Avoid division by zero if threshold is 0
          similarity = (1 - (adjustedDistance / baseResult.threshold)) * 100;
        } else if (adjustedDistance === 0) { // If threshold is 0, perfect match if distance is also 0
          similarity = 100;
        }
        similarity = Math.max(0, Math.min(100, similarity));


        loader.style.display = 'none';
        setButtonLoading(analyzeBtn, false);
        // updateButtonState() is called within setButtonLoading(false)

        const confidenceColor = verified ? 'var(--secondary)' : 'var(--danger)';
        const gradientColorStart = verified ? '#10b981' : '#ef4444'; // Base color for gradient
        const gradientColorEnd = verified ? '#34d399' : '#f87171'; // Lighter shade for gradient end


        resultDiv.className = verified ? 'result-success' : 'result-error';

        resultDiv.innerHTML = `
          <div class="result-header" style="color: ${confidenceColor};">
            <span>${verified ? '✅' : '❌'}</span>
            <span>${verified ? 'LIKELY SAME PERSON' : 'LIKELY DIFFERENT PEOPLE'}</span>
          </div>
          
          <div class="result-grid">
            <div class="result-item">
              <div class="result-label">🤖 AI Model</div>
              <div class="result-value">${selectedModel}</div>
            </div>
            <div class="result-item">
              <div class="result-label">📊 Similarity Metric</div>
              <div class="result-value">Cosine Distance</div>
            </div>
            <div class="result-item">
              <div class="result-label">📏 Distance Score</div>
              <div class="result-value">${adjustedDistance.toFixed(4)} (lower is more similar)</div>
            </div>
            <div class="result-item">
              <div class="result-label">🎚️ Decision Threshold</div>
              <div class="result-value">${baseResult.threshold.toFixed(3)} (distance < threshold suggests same)</div>
            </div>
          </div>

          <div class="similarity-section">
            <div class="similarity-header">
              <div class="similarity-label">📈 Calculated Similarity Score</div>
              <div class="similarity-percentage" style="color: ${confidenceColor};">${similarity.toFixed(1)}%</div>
            </div>
            <div class="similarity-bar">
              <div class="similarity-fill" style="width: ${Math.max(similarity, 2)}%; background: linear-gradient(90deg, ${gradientColorStart}, ${gradientColorEnd});"></div>
            </div>
          </div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: var(--space-4);">
            Note: This is a simplified mock result. Actual similarity scores depend heavily on the model and image quality.
          </div>
        `;

      } catch (error) {
        loader.style.display = 'none';
        setButtonLoading(analyzeBtn, false);
        // updateButtonState() is called within setButtonLoading(false)
        console.error('Error during analysis:', error);

        resultDiv.className = 'result-error';
        resultDiv.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; gap: var(--space-2); color: var(--danger);">
                                 <span>🔌</span> An error occurred during analysis. Please try again.
                               </div>`;
      }
    });

    // Initialize the app
    document.addEventListener('DOMContentLoaded', function () {
      initializeDragAndDrop();
      updateButtonState();
      // Set initial message in result div if it's empty
      const resultDiv = document.getElementById('result');
      if (resultDiv.innerHTML.trim() === '') {
        resultDiv.innerHTML = `
            <div class="initial-message">
                <span>📤</span> 
                Upload two images and select an AI model to begin analysis
            </div>`;
      }
    });

    // Cleanup webcam streams when page unloads
    window.addEventListener('beforeunload', function () {
      stopWebcam(1);
      stopWebcam(2);
    });

    // Handle visibility change to pause/resume webcam (good for performance and privacy)
    document.addEventListener('visibilitychange', function () {
      const streams = [webcamStream1, webcamStream2];
      streams.forEach(stream => {
        if (stream) {
          stream.getTracks().forEach(track => {
            track.enabled = !document.hidden;
          });
        }
      });
    });
  </script>
</body>

</html>